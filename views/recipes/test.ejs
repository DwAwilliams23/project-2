<%- include('../partials/header') %>
<div id="recipe-div">
  <div id="show-ed-de-div">
    <div id="show-page">
      <div>Cuisine: </div>
      <div>
        <% if (recipe.cuisine) { %>
          <%= recipe.cuisine.name %>
        <% } %>
      </div>
      <div>Type of Food: </div>
      <div><%= recipe.foodType %></div>
      <div>Servings: </div>
      <div><%= recipe.serving %></div>
      <div>Prep Time: </div>
      <div><%= recipe.prepTime %></div>
      <div>Cook Time: </div>
      <div><%= recipe.cookTime %></div>
      <div>Total Time: </div>
      <div><%= recipe.totalTime %></div>
      <div>Have made before: </div>
      <div><%= recipe.haveMade ? 'Yes' : 'No' %></div>
    </div>
    <div id="ed-de-div">
      <div class="edit-button">
        <button id="editOriginalButton" onclick="replaceAndToggleEditButtons()" id="toggleEditButtons">
          <img src="/images/edit-icon.png" alt="Edit Icon" class="ed-de-icon"/>
        </button>
      </div>
      <div id="editNewButtons" class="hidden">
        <div id="confcanc-buttons">
          <button onclick="restoreAndToggleEditButton()">
            <img src="/images/edit-icon.png" alt="Edit Icon" class="ed-de-icon"/>
          </button>
          <a href="/recipes/<%= recipe._id %>/edit">
            <button type="submit">
              <img src="/images/check.png" alt="Check Icon" class="ed-de-icon" id="check-button"/>
            </button>
          </a>
        </div>
      </div>
      <div class="trash-button">
        <button id="deleteOriginalButton" onclick="replaceDeleteButtons()">
          <img src="/images/trash-icon.png" alt="Trash Icon" class="ed-de-icon">
        </button>
      </div>
      <div id="deleteNewButtons" class="hidden">
        <div id="confcanc-buttons">
          <button onclick="restoreDeleteButton()">
            <img src="/images/close.png" alt="Close Icon" class="ed-de-icon" id="close-button">
          </button>
          <form action="/recipes/<%= recipe._id %>?_method=DELETE" method="POST">
            <button type="submit">
              <img src="/images/check.png" alt="Check Icon" class="ed-de-icon" id="check-button"/>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    
    function replaceEditButtons() {
      var originalButton = document.getElementById("editOriginalButton");
      var newButtons = document.getElementById("editNewButtons");
      
      originalButton.classList.add("hidden");
      newButtons.classList.remove("hidden");
    }
    
    function restoreEditButton() {
      var originalButton = document.getElementById("editOriginalButton");
      var newButtons = document.getElementById("editNewButtons");
      
      originalButton.classList.remove("hidden");
      newButtons.classList.add("hidden");
    }
    
    function replaceDeleteButtons() {
      var originalButton = document.getElementById("deleteOriginalButton");
      var newButtons = document.getElementById("deleteNewButtons");
      
      originalButton.classList.add("hidden");
      newButtons.classList.remove("hidden");
    }
    
    function restoreDeleteButton() {
      var originalButton = document.getElementById("deleteOriginalButton");
      var newButtons = document.getElementById("deleteNewButtons");
      
      originalButton.classList.remove("hidden");
      newButtons.classList.add("hidden");
    }
    
    function replaceAndToggleEditButtons() {
      replaceEditButtons();
      toggleButtons();
    }
    
    function restoreAndToggleEditButton() {
      restoreEditButton();
      toggleButtons();
    }
    </script>

  <% if (recipe.ingredients.length) { %>
    <div class="instruction-list">
      <h2>Ingredients</h2>
        <ul>
          <% let total = 0 %>
          <% recipe.ingredients.forEach(function(r) { %>
                <li>
                  <%= r.quantity %>
                  <%= r.measurement %>
                  <%= r.content %>
                </li>
                <div>
                  <div class="edit-delete-buttons hidden">
                    <% if (user?._id.equals(r.user)) { %>
                      <button class="list-edit-button">
                        <a href="recipes/ingredients/<%= r._id %>/edit">
                          Edit
                        </a>
                      </button>
                    <% } %>
                  </div>
                </div>
                <div>
                  <div class="edit-delete-buttons hidden" >
                    <% if (user?._id.equals(r.user)) { %>
                      <form action="/ingredients/<%= r._id %>?_method=DELETE" method="POST" class="x-form">
                        <button class="x-button" type="submit">X</button>
                      </form>
                    <% } %>
                  </div>
                </div>
          <% }); %>
        </ul>
    </div>
  <% } %>
  
  <div class="input-div">
    <div class="edit-delete-buttons" style="display: none;">
      <% if(user) { %>
        <form id="add-ingredient-form" method="POST"
          action="/recipes/<%= recipe._id %>/ingredients">
          <input  name="quantity" id="quantity-form" placeholder="Qty."></input>
          <select name="measurement" id="measurement-form">
            <option value="" selected disabled>Measurement</option>
            <option value="Pinch">Pinch</option>
            <option value="Dash">Dash</option>
            <option value="Ounce">Ounce</option>
            <option value="Teaspoon">Teaspoon</option>
            <option value="Tablespoon">Tablespoon</option>
            <option value="Pound">Pound</option>
            <option value="Fluid Ounce">Fluid Ounce</option>
            <option value="Cup">Cup</option>
            <option value="Pint">Pint</option>
            <option value="Quart">Quart</option>
            <option value="Gallon">Gallon</option>
          </select>
          <input  name="content" id="ingredient-form" placeholder="Ingredient Name"></input>
          <input type="submit" value="Add Ingredient">
        </form>
      <% } %>
    </div>
  </div>
  
  <% if (recipe.steps.length) { %>
    <div class="instruction-list">
      <h2>Steps</h2>
        <ol>
          <% let total = 0 %>
          <% recipe.steps.forEach(function(r) { %>
                <li>
                  <%= r.content %>
                </li>
                <div>
                  <div class="edit-delete-buttons" style="display: none;">
                    <% if (user?._id.equals(r.user)) { %>
                      <button class="list-edit-button">
                        <a href="recipes/steps/<%= r._id %>/edit">
                          Edit
                        </a>
                      </button>
                    <% } %>
                  </div>
                </div>
                <div>
                  <div class="edit-delete-buttons" style="display: none;">
                    <% if (user?._id.equals(r.user)) { %>
                      <form action="/steps/<%= r._id %>?_method=DELETE" method="POST" class="x-form">
                        <button class="x-button" type="submit">X</button>
                      </form>
                    <% } %>
                  </div>
                </div>
          <% }); %>
        </ol>
    </div>
  <% } %>
  
  <div class="input-div">
    <div class="edit-delete-buttons" style="display: none;">
      <% if(user) { %>
        <form id="add-step-form" method="POST"
          action="/recipes/<%= recipe._id %>/steps">
          <textarea id="step-form" name="content" placeholder="Add New Step"></textarea>
          <input type="submit" value="Add Step">
        </form>
      <% } %>
    </div>
  </div>
</div>
<%- include('../partials/footer') %>